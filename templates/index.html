{% extends "base.html" %}
{% block content %}
<!-- Add Filter Menu -->
<div class="filter-menu">
    <div class="filter-section">
        <button class="filter-toggle"><i class="fas fa-filter"></i> Filters</button>
        <!-- Users Filter -->
        <div class="filter-dropdown">
            <h4>Discord Users</h4>
            <div class="user-filters">
                {% set users = [] %}
                {% for screenshot in screenshots %}
                    {% if screenshot['uploader_name'] not in users %}
                        {% set _ = users.append(screenshot['uploader_name']) %}
                    {% endif %}
                {% endfor %}
                {% for user in users|sort %}
                <label class="filter-checkbox">
                    <input type="checkbox" data-filter="user" value="{{ user }}" />
                    <i class="fa-brands fa-discord"></i> {{ user }}
                </label>
                {% endfor %}
            </div>
        </div>
        <!-- Tags Filter -->
        <div class="filter-dropdown">
            <h4>Tags</h4>
            <div class="tag-filters">
                {% set all_tags = [] %}
                {% for screenshot in screenshots %}
                    {% if screenshot['tags'] %}
                        {% for tag in screenshot['tags'].split(',') %}
                            {% if tag.strip() not in all_tags %}
                                {% set _ = all_tags.append(tag.strip()) %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                {% for tag in all_tags|sort %}
                <label class="filter-checkbox">
                    <input type="checkbox" data-filter="tag" value="{{ tag }}" />
                    #{{ tag }}
                </label>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Image Grid -->
<div class="image-grid">
    {% for screenshot in screenshots %}
    <div class="grid-item loading" data-user="{{ screenshot['uploader_name'] }}" data-tags="{{ screenshot['tags'] or '' }}">
        <img src="{{ url_for('static', filename='images/' + screenshot['filename']) }}" 
             alt="Shot by {{ screenshot['uploader_name'] }}"
             loading="lazy"
             onload="this.parentElement.classList.remove('loading')" />
        <div class="image-info">
            {% if screenshot['group_name'] %}
                <p class="group fancy-text">{{ screenshot['group_name'] }}</p>
            {% endif %}
            <p class="date small no-padding no-margin">{{ screenshot['upload_date'] }}</p>
            {% if screenshot['tags'] %}
                <div class="tags">
                    {% for tag in screenshot['tags'].split(',') %}
                        <span class="tag_badge bg-pill">#{{ tag.strip() }}</span>
                    {% endfor %}
                </div>
            {% endif %}
            
            {% if screenshot['uploader_type'] == 'discord' %}
            <p class="username bold underline">
                @{{ screenshot['uploader_name'] }}
                <i class="fa-brands fa-discord small no-round tiny-padding"></i>
            </p>
            {% else %}
            <p class="username bold underline">
                @{{ screenshot['uploader_name'] }}
                <i class="fa-regular fa-user small no-round tiny-padding"></i>
            </p>
            {% endif %}

            <nav class="auto-width">
                <div class="image-actions tiny-padding">
                    {% if session.uploader_name == screenshot.uploader_name or user_role in ['admin', 'moderator'] %}
                    <form action="{{ url_for('delete_image', filename=screenshot.filename) }}" method="POST" class="d-inline">
                        <span type="submit" class="me-2 max medium bg-transparent text-muted">Delete</span>
                    </form>
                    {% endif %}
                    <span type="button" class="me-2 max medium bg-transparent text-muted" data-toggle="modal" data-target="#reportModal-{{ loop.index }}">
                        Report
                    </span>
                </div>
            </nav>
        </div>
    </div>

    <!-- Report Modal for each image -->
    <div class="modal fade on-top" id="reportModal-{{ loop.index }}" tabindex="-1">
        ...
    </div>
    {% endfor %}
</div>


<!-- Lightbox -->
<div class="lightbox">
    <div class="close-lightbox">
        <i class="fas fa-times"></i>
    </div>
    <div class="lightbox-nav lightbox-prev">
        <i class="fas fa-chevron-left"></i>
    </div>
    <img src="" alt="Enlarged view">
    <div class="lightbox-nav lightbox-next">
        <i class="fas fa-chevron-right"></i>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Your existing JavaScript code here
});
</script>
{% endblock %}