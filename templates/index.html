{% extends "base.html" %}
{% block content %}
<!-- Add Filter Menu -->
<div class="filter-menu">
    <div class="filter-section">
        <button class="filter-toggle"><i class="fas fa-filter"></i> Filters</button>
        <!-- Users Filter -->
        <div class="filter-dropdown">
            <h4>Users</h4>
            <div class="user-filters">
                {% set users = [] %}
                {% for screenshot in screenshots %}
                    {% if screenshot['uploader_name'] not in users %}
                        {% set _ = users.append(screenshot['uploader_name']) %}
                    {% endif %}
                {% endfor %}
                {% for user in users|sort %}
                <label class="filter-checkbox">
                    <input type="checkbox" data-filter="user" value="{{ user }}" />
                    <i class="fa-regular fa-user small no-round tiny-padding"></i> {{ user }}
                </label>
                {% endfor %}
            </div>
        </div>
        <!-- Tags Filter -->
        <div class="filter-dropdown">
            <h4>Tags</h4>
            <div class="tag-filters">
                {% set all_tags = [] %}
                {% for screenshot in screenshots %}
                    {% if screenshot['tags'] %}
                        {% for tag in screenshot['tags'].split(',') %}
                            {% if tag.strip() not in all_tags %}
                                {% set _ = all_tags.append(tag.strip()) %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
                {% for tag in all_tags|sort %}
                <label class="filter-checkbox">
                    <input type="checkbox" data-filter="tag" value="{{ tag }}" />
                    #{{ tag }}
                </label>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Single Grid Container -->
<div class="image-grid">
    {% for screenshot in screenshots %}
    <div class="grid-item loading"
         data-user="{{ screenshot['uploader_name'] }}"
         data-tags="{{ screenshot['tags'] or '' }}"
         data-date="{{ screenshot['upload_date'] or '' }}"
         data-group="{{ screenshot['group_name'] or '' }}">
  
      <!-- The screenshot image -->
      <img src="{{ url_for('static', filename='images/' + screenshot['filename']) }}"
           alt="Shot by {{ screenshot['uploader_name'] }}"
           loading="lazy"
           onload="this.parentElement.classList.remove('loading')" />
  
      <!-- Info overlay -->
      <div class="image-info">
        {% if screenshot['group_name'] %}
        <p class="group fancy-text">{{ screenshot['group_name'] }}</p>
        {% endif %}
        
        <p class="date small no-padding no-margin">{{ screenshot['upload_date'] }}</p>
        
        {% if screenshot['tags'] %}
        <div class="tags">
          {% for tag in screenshot['tags'].split(',') %}
          <span class="tag_badge bg-pill">#{{ tag.strip() }}</span>
          {% endfor %}
        </div>
        {% endif %}
        
        <p class="username bold underline">
          @{{ screenshot['uploader_name'] }}
          <i class="fa-regular fa-user small no-round tiny-padding"></i>
        </p>
        
        <nav class="auto-width">
          <div class="image-actions tiny-padding">
            {% if session.get('username') == screenshot.uploader_name or user_role in ['admin', 'moderator'] %}
            <form action="{{ url_for('delete_image', filename=screenshot.filename) }}"
                  method="POST" class="d-inline">
              <button type="submit" class="btn_better_del_mobile">Delete</button>
            </form>
            {% endif %}
          </div>
        </nav>
      </div>
      
      <!-- Optional: A modal for reporting, if you want to include it here
      <div class="modal fade" id="reportModal-{{ loop.index }}" tabindex="-1">
        ...
      </div>
      -->
  
    </div>
    {% endfor %}
  </div>  


<!-- Lightbox -->
<div class="lightbox">
    <div class="close-lightbox">
        <i class="fas fa-times"></i>
    </div>
    <div class="lightbox-nav lightbox-prev">
        <i class="fas fa-chevron-left"></i>
    </div>
    
    <!-- The image displayed in the lightbox -->
    <img src="" alt="Enlarged view">
    
    <div class="lightbox-nav lightbox-next">
        <i class="fas fa-chevron-right"></i>
    </div>

    <!-- The info container at the bottom of the lightbox -->
    <div class="lightbox-info"></div>
</div>



<script>
document.addEventListener("DOMContentLoaded", function () {
  // Your existing JavaScript code here
});
</script>
{% endblock %}